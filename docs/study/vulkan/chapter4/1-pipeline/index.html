<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Pipeline overview#stage#TOP_OF_PIPE_BIT
DRAW_INDIRECT_BIT
VERTEX_INPUT_BIT
VERTEX_SHADER_BIT
TESSELLATION_CONTROL_SHADER_BIT
TESSELLATION_EVALUATION_SHADER_BIT
GEOMETRY_SHADER_BIT
FRAGMENT_SHADER_BIT
EARLY_FRAGMENT_TESTS_BIT
LATE_FRAGMENT_TESTS_BIT
COLOR_ATTACHMENT_OUTPUT_BIT
TRANSFER_BIT
COMPUTE_SHADER_BIT
BOTTOM_OF_PIPE_BIT
HOST_BIT
ALL_GRAPHICS_BIT
ALL_COMMANDS_BIT
source#生产阶段
target#消费阶段
source 之后 target 之前
vkCmdPipelineBarrier( commandBuffer, VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT, // source stage VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT, // destination stage /* remaining parameters omitted */); 这种转换表示，GPU 上当前正在进行的所有命令都需要完成，然后才执行该转换，并且在它完成转换之前，不允许任何命令开始。这个障碍会等待一切完成，并阻止任何工作在它开始之前启动。
vkCmdPipelineBarrier( commandBuffer, VK_PIPELINE_VERTEX_SHADER_BIT, // source stage VK_PIPELINE_COMPUTE_SHADER_BIT, // destination stage /* remaining parameters omitted */); If you write to a render target and read from it in a fragment shader, the stages would be VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT as the source and VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT as the destination – typical for G-Buffer rendering.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/docs/study/vulkan/chapter4/1-pipeline/">
  <meta property="og:site_name" content="YCK-DZ">
  <meta property="og:title" content="pipeline">
  <meta property="og:description" content="Pipeline overview#stage#TOP_OF_PIPE_BIT
DRAW_INDIRECT_BIT
VERTEX_INPUT_BIT
VERTEX_SHADER_BIT
TESSELLATION_CONTROL_SHADER_BIT
TESSELLATION_EVALUATION_SHADER_BIT
GEOMETRY_SHADER_BIT
FRAGMENT_SHADER_BIT
EARLY_FRAGMENT_TESTS_BIT
LATE_FRAGMENT_TESTS_BIT
COLOR_ATTACHMENT_OUTPUT_BIT
TRANSFER_BIT
COMPUTE_SHADER_BIT
BOTTOM_OF_PIPE_BIT
HOST_BIT
ALL_GRAPHICS_BIT
ALL_COMMANDS_BIT
source#生产阶段
target#消费阶段
source 之后 target 之前
vkCmdPipelineBarrier( commandBuffer, VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT, // source stage VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT, // destination stage /* remaining parameters omitted */); 这种转换表示，GPU 上当前正在进行的所有命令都需要完成，然后才执行该转换，并且在它完成转换之前，不允许任何命令开始。这个障碍会等待一切完成，并阻止任何工作在它开始之前启动。
vkCmdPipelineBarrier( commandBuffer, VK_PIPELINE_VERTEX_SHADER_BIT, // source stage VK_PIPELINE_COMPUTE_SHADER_BIT, // destination stage /* remaining parameters omitted */); If you write to a render target and read from it in a fragment shader, the stages would be VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT as the source and VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT as the destination – typical for G-Buffer rendering.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="docs">
<title>pipeline | YCK-DZ</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/f2.ico" >
<link rel="canonical" href="http://localhost:1313/docs/study/vulkan/chapter4/1-pipeline/">
<link rel="stylesheet" href="/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css" integrity="sha256-MJt&#43;0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.653976fc1c9c74ea3ee0e9dd83cef298301f466db85eac3b0e3aa5537148da2e.js" integrity="sha256-ZTl2/BycdOo&#43;4Ondg87ymDAfRm24Xqw7DjqlU3FI2i4=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>

  

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/f2.png" alt="Logo" /><span>YCK-DZ</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <a href="/docs/study/" class="">vulkan学习</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-1aa90340d032c5d9f8cf998deec6ef6c" class="toggle"  />
    <label for="section-1aa90340d032c5d9f8cf998deec6ef6c" class="flex justify-between">
      <a href="/docs/study/vulkan/chapter1/" class="">chapter1 基本概念</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/study/vulkan/chapter1/first/" class="">Instance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/study/vulkan/chapter1/device/" class="">设备</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0ab855d195155d0c45c4428e53694186" class="toggle"  />
    <label for="section-0ab855d195155d0c45c4428e53694186" class="flex justify-between">
      <a href="/docs/study/vulkan/chapter2/" class="">chapter2 三角形出来</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2bc6ff8da192bb919c40105dba69871c" class="toggle"  />
    <label for="section-2bc6ff8da192bb919c40105dba69871c" class="flex justify-between">
      <a href="/docs/study/vulkan/chapter3/" class="">chapter3 纹理</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-940dccf530a93c91d0814820bf6df4d0" class="toggle" checked />
    <label for="section-940dccf530a93c91d0814820bf6df4d0" class="flex justify-between">
      <a href="/docs/study/vulkan/chapter4/" class="">chapter4 同步</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/study/vulkan/chapter4/1-pipeline/" class="active">pipeline</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/study/vulkan/chapter4/2-blit/" class="">vkCmdBlitImage</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Shortcodes</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/buttons/" class="">Buttons</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/columns/" class="">Columns</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/details/" class="">Details</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/expand/" class="">Expand</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/hints/" class="">Hints</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-d4c83c0dd655503a3da63d0c6550ed41" class="toggle"  />
    <label for="section-d4c83c0dd655503a3da63d0c6550ed41" class="flex justify-between">
      <a href="/docs/shortcodes/section/" class="">Section</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/section/page1/" class="">Page1</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/section/page2/" class="">Page2</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/tabs/" class="">Tabs</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="/posts/"  >
        Blog
      </a>
  </li>
  
  <li>
    <a href="/posts/math/"  >
        Math
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>pipeline</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#stage">stage</a>
      <ul>
        <li><a href="#source">source</a></li>
        <li><a href="#target">target</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="pipeline-overview">
  Pipeline overview
  <a class="anchor" href="#pipeline-overview">#</a>
</h1>
<h2 id="stage">
  stage
  <a class="anchor" href="#stage">#</a>
</h2>
<ul>
<li>
<p>TOP_OF_PIPE_BIT</p>
</li>
<li>
<p>DRAW_INDIRECT_BIT</p>
</li>
<li>
<p>VERTEX_INPUT_BIT</p>
</li>
<li>
<p>VERTEX_SHADER_BIT</p>
</li>
<li>
<p>TESSELLATION_CONTROL_SHADER_BIT</p>
</li>
<li>
<p>TESSELLATION_EVALUATION_SHADER_BIT</p>
</li>
<li>
<p>GEOMETRY_SHADER_BIT</p>
</li>
<li>
<p>FRAGMENT_SHADER_BIT</p>
</li>
<li>
<p>EARLY_FRAGMENT_TESTS_BIT</p>
</li>
<li>
<p>LATE_FRAGMENT_TESTS_BIT</p>
</li>
<li>
<p>COLOR_ATTACHMENT_OUTPUT_BIT</p>
</li>
<li>
<p>TRANSFER_BIT</p>
</li>
<li>
<p>COMPUTE_SHADER_BIT</p>
</li>
<li>
<p>BOTTOM_OF_PIPE_BIT</p>
</li>
<li>
<p>HOST_BIT</p>
</li>
<li>
<p>ALL_GRAPHICS_BIT</p>
</li>
<li>
<p>ALL_COMMANDS_BIT</p>
</li>
</ul>
<h3 id="source">
  source
  <a class="anchor" href="#source">#</a>
</h3>
<p>生产阶段</p>
<h3 id="target">
  target
  <a class="anchor" href="#target">#</a>
</h3>
<p>消费阶段</p>
<p><code>source</code> 之后 <code>target</code> 之前</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>vkCmdPipelineBarrier(
</span></span><span style="display:flex;"><span>    commandBuffer,
</span></span><span style="display:flex;"><span>    VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT, <span style="color:#75715e">// source stage</span>
</span></span><span style="display:flex;"><span>    VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT,    <span style="color:#75715e">// destination stage</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* remaining parameters omitted */</span>);
</span></span></code></pre></div><p>这种转换表示，GPU 上当前正在进行的所有命令都需要完成，然后才执行该转换，并且在它完成转换之前，不允许任何命令开始。这个障碍会等待一切完成，并阻止任何工作在它开始之前启动。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">vkCmdPipelineBarrier</span>(
</span></span><span style="display:flex;"><span>    commandBuffer,
</span></span><span style="display:flex;"><span>    VK_PIPELINE_VERTEX_SHADER_BIT,     <span style="color:#75715e">// source stage
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    VK_PIPELINE_COMPUTE_SHADER_BIT,    <span style="color:#75715e">// destination stage
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">/* remaining parameters omitted */</span>);
</span></span></code></pre></div><p>If you write to a render target and read from it in a fragment shader, the stages would be VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT as the source and VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT as the destination – typical for G-Buffer rendering. For shadow maps, the source would be VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT. Another typical example is copying data – you produce the data through a copy, so the source stage would be set to VK_PIPELINE_STAGE_TRANSFER_BIT, and the destination to the stage where you need it. For vertex buffers, this would be for instance VK_PIPELINE_STAGE_VERTEX_INPUT_BIT.</p>
<p>Generally, you should try to maximize the number of “unblocked” stages, that is, produce data early and wait late for it. It’s always safe on the producer side to move towards the bottom of the pipe, as you’ll wait for more and more stages to finish, but it won’t improve performance. Similarly, if you want to be safe on the target side, you move upwards towards the top of pipe – but it prevents more stages from running, so that should be avoided as well.</p>
<p>One final remark: as mentioned previously, the hardware may not have all the stages internally, or may not be able to signal or wait at the specified stage. In those cases, the driver is free to move your source stage towards the bottom of the pipe and the target stage towards the top. This is implementation-specific though, and you should not have to worry about this – your goal should be to set the stages as “tight” as possible and minimize the number the blocked stages.</p>
<p>
  <a href="https://gpuopen.com/learn/vulkan-barriers-explained/">来源</a></p>
<p>If a synchronization command includes a source stage mask, its first synchronization scope only includes execution of the pipeline stages specified in that mask and any logically earlier stages. Its first access scope only includes memory accesses performed by pipeline stages explicitly specified in the source stage mask.</p>
<p>If a synchronization command includes a destination stage mask, its second synchronization scope only includes execution of the pipeline stages specified in that mask and any logically later stages. Its second access scope only includes memory accesses performed by pipeline stages explicitly specified in the destination stage mask.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

<script src="https://utteranc.es/client.js"
        repo="yuncheolkim/hugoblogcomment"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script></div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#stage">stage</a>
      <ul>
        <li><a href="#source">source</a></li>
        <li><a href="#target">target</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












